---
title: "Data Analytics for Behavioural Research"
subtitle: "ECMCRC Summer School on Behavioral and Neuroscientific Research for Economics and Finance"
author: "Damien Dupré"
date: "Dublin City University, July 2nd 2019"
output:
  xaringan::moon_reader:
    css: [default, metropolis, metropolis-fonts]
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

```{r setup, include = FALSE}
# general options ----------------------------------------------------------------------
options(scipen = 999) #disable sci number format
# chunk options ----------------------------------------------------------------
knitr::opts_chunk$set(
  cache.extra = knitr::rand_seed, 
  message = FALSE, 
  warning = FALSE, 
  error = FALSE, 
  echo = FALSE, 
  fig.align="center"
  )
# libraries --------------------------------------------------------------------
library(tidyverse)
library(knitr)
library(nomnoml)
```

# Programme

* Data Analytics for Behavioural Research (I)
  * The (data) science of emotions
* Data Analytics for Behavioural Research (II)
  * Introduction to data science with R
* Data Analytics for Behavioural Research (III)
  * Gentle introduction to emotion analysis
    * Sentiment Analysis
    * Facial Expression
    * Physiology

---
class: inverse, center, middle

# The (data) science of emotions

---

# Why measuring emotional experience?

The emotional experience determines our perceptions and leads our decisions 
* In every life (e.g. the Phineas Gage Case; Damasio, 1994)
* In consumer behaviors (Dumaine 1991, p. 86) 
    * A first evaluative process was trigged from aesthetical perceptions (Mahlke, 2008)
    * Emotions responses were generated following these process (Hong & Wyer, 1998; Ko, Sung & Yoon, 2008)
    * Choices and decisions are made according both cognitive and emotional treatment (Bloch, 1995)

---

# What Emotions are?

“Everyone knows what an emotion is, until asked to give a definition. Then, it seems no one knows.” (Fehr and Russell, 1984) 

<video width="500" height="500" controls>
  <source src="./img/videoplayback.mp4" type="video/mp4">
</video> 

---

# History of Emotion Science

```{r out.width = "100%"}
knitr::include_graphics("./img/emotion_timeline.png") 
```

---

# What Emotions are not?

* Emotions are from the affect / affective state family as well as moods and attitudes.
* Affective state refers to "refers to valenced (good versus bad) states" (Gross, 2010, p. 212).

```{nomnoml}
#stroke: orange
#direction: down
#align: center

[Affect]->[Attitude]
[Affect]->[Emotions]
[Affect]->[Moods]
```

---

# What Emotions are not?

* Attitudes are **relatively stable beliefs about the goodness or badness of something or someone**; they bias how a person will think about, feel towards, and behave regarding that thing or person (Frijda, 1994). 

* Moods are **less stable than attitudes**, and unlike attitudes, often **do not have specific objects**. Changes in feeling tone are predominant, and moods seem to bias cognition more than action (Siemer, 2005). 

* Emotions are **the shortest** lived of these three affective processes. They are responses to situations that are perceived as **relevant to an individual’s current goals**, and consist of appraisals (or ways of construing the situation) which give rise to loosely coordinated changes in experiential, behavioral, and physiological response channels (Levenson, 1999).

---

# 7 characteristics of emotions

From Scherer (2005)

```{r}
tibble::tribble(
  ~Characteristic, ~Description,
  "Event focus", "“something happens to the organism that stimulates or triggers a response after having been evaluated for its significance”",
  "Appraisal driven","“eliciting event and its consequences must be relevant to major concerns of the organism”",
  "Response synchronization", "“all or most of the subsystems of the organism must contribute to response preparation”",
  "Rapidity of change","“emotion processes are undergoing constant modification allowing rapid readjustment to changing circumstances or evaluations”",
  "Behavioural impact","“Emotions prepare adaptive action tendencies and their motivational underpinnings”",
  "Intensity", "“the response patterns and the corresponding emotional experience [is expected] to be relatively high”",
  "Duration", "“must be relatively short in order not to tax the resources of the organism and to allow behavioural flexibility”"
) %>%
  knitr::kable(format='html') %>%
  kableExtra::kable_styling(font_size = 12)
```

---

# Functions of Emotions

```{r out.width = "70%"}
knitr::include_graphics("./img/emotion_functions.png") 
```

Scherer, K. R. (2005). What are emotions? And how can they be measured?. Social science information, 44(4), 695-729.

---

# Function 1: Evaluation 

* Emotion and cognition are interacting systems
  * Emotions helps to identify the valence of an object/event and provides solutions to behave accordingly (decision-making process).
  * Example of Phineas Gage (Damasio, 1994)

* Stimulus Evaluation Checks (Scherer, 2001)
    * Relevance according goals and needs
    * Implication of consequences
    * Potential Coping of consequences
    * Significance for norms, values and standards

```{r out.width = "100%"}
knitr::include_graphics("./img/sec_figure.png") 
```

---

# Function 2: System regulation 

* Emotions modulate and influence physiological rhythms
    * Heart Rate, Heart Rate Variability
    * Breathing Rate
    * Skin Temperature
    * Electrodermal Activity
    * ...

---

# Function 3: Preparation of actions

* Emotions enable fast and adaptive response to the triggered event
    * Principle of Action Tendency (Frijda, 1986)
    * fight or flight

---

# Function 4: Communication

* Facial Expressions
    * Duchenne de Boulogne (1862) 
    * Darwin (1889)
    * Ekman (1968)
        * Create Facial Action Unit System (FACS)
        * Facial Expressions of Emotions (EmFACS)

Only 6 (7) universal facial expressions of emotion

---

# Function 4: Communication

* Debate: what do facial expressions convey?
  * Action Readiness (Frijda, 1986)
  * States of Cognitive Appraisal (Scherer, 2005)
  * Feeling states (Ekman, 1984)
  * Social message (Fridlund, 1994)

<video width="400" height="400" controls>
  <source src="./img/DynEmo Fear.mp4" type="video/mp4">
</video> 

---

# Function 5: Monitoring internal states

* Access to psycho-physiological changes related to the emotional experience
* Give a meaning to these changes and which allow to voluntarily regulate the emotional state

```{r out.width = "100%"}
knitr::include_graphics("./img/emotion_monitoring.png") 
```

---

# Function 5: Monitoring internal states

* Categorical access
  * Ekman's 6 basic emotions
  * Plutchik's Wheel of Emotions
  * Geneva Emotion Wheel model 1/2/3/...
  * ...
  
* Dimensional access (Russell, 1984)
  * Valence, Arousal, Dominance
  * Circumplex Model of Affect
  * Self Assessment Manikin (SAM)

---

# Psychological Structure of Emotions

* Basic Emotion Theory (Ekman, 1971)?
* Constructionist Theory (Russell, 1980)?
* Appraisal Theory (Scherer, 2005)?

---

# Component Process Model of Emotions

And applications to product testing

* Subjective feeling
  * e.g. Desmet, Hekkert, & Hillen (2003)
* Cognitive appraisal
  * e.g. Herbeth & Blumenthal (2013)
* Action readiness
  * Schoen & Crilly (2014)
* Expressive Patterns
  * Mahlke (2008)
* Physiological reactions
  * Carbon, Michael, & Leder (2008)

---

# Component Process Model of Emotions

```{nomnoml}
#stroke: orange
#align: center

[Emotion|
  [Cognitive Component]->[Motivational Component]
  [Cognitive Component]->[Physiological Component]
  [Cognitive Component]->[Expressive Component]
  [Motivational Component]->[Subjective Component]
  [Physiological Component]->[Subjective Component]
  [Expressive Component]->[Subjective Component]
]

[<abstract>Trigger Event]--:>[Emotion]
```

---

# Component Process Model of Emotions

Emotion is defined as “an **episode of interrelated, synchronized changes** in the states of **all or most of the five organismic subsystems** in **response to the evaluation of an external or internal stimulus** event as relevant to major concerns of the organism” (Scherer, 1987)

---
class: inverse, center, middle

# How to measure emotions?

---

# Self-reports

* Verbal vs. Non-verbal
* Warning: Access to inner states is biased

```{nomnoml}
#stroke: black
#align: center
#.box: fill=orange

[Emotion|
  [<box>Cognitive Component]->[<box>Motivational Component]
  [<box>Cognitive Component]->[<box>Physiological Component]
  [<box>Cognitive Component]->[<box>Expressive Component]
  [<box>Motivational Component]->[<box>Subjective Component]
  [<box>Physiological Component]->[<box>Subjective Component]
  [<box>Expressive Component]->[<box>Subjective Component]
]
```

---

# Sentiment analysis

Attribute an emotional coefficient to a word or a series of word (e.g., tweets, reviews, books)
* Can be categorical  for basic emotions
* Can be dimensional with valence and arousal

```{nomnoml}
#stroke: black
#align: center
#.box: fill=orange

[Emotion|
  [Cognitive Component]->[Motivational Component]
  [Cognitive Component]->[Physiological Component]
  [Cognitive Component]->[Expressive Component]
  [Motivational Component]->[<box>Subjective Component]
  [Physiological Component]->[<box>Subjective Component]
  [Expressive Component]->[<box>Subjective Component]
]
```

---

# Physiological Sensors

Wired vs. Wireless

```{nomnoml}
#stroke: black
#align: center
#.box: fill=orange

[Emotion|
  [Cognitive Component]->[<box>Motivational Component]
  [Cognitive Component]->[<box>Physiological Component]
  [Cognitive Component]->[<box>Expressive Component]
  [<box>Motivational Component]->[Subjective Component]
  [<box>Physiological Component]->[Subjective Component]
  [<box>Expressive Component]->[Subjective Component]
]
```

---

# Observation

Human vs. Automatic

```{nomnoml}
#stroke: black
#align: center
#.box: fill=orange

[Emotion|
  [Cognitive Component]->[<box>Motivational Component]
  [Cognitive Component]->[Physiological Component]
  [Cognitive Component]->[<box>Expressive Component]
  [<box>Motivational Component]->[Subjective Component]
  [Physiological Component]->[Subjective Component]
  [<box>Expressive Component]->[Subjective Component]
]
```

---
class: inverse, center, middle

# Introduction to data science with R

---

# Rstudio Cloud

1. Go to: https://rstudio.cloud/
2. Sign up
3. In your workspace, create a new project and launch it (can take 1 or 2 minutes)

---

# RStudio IDE

Made of 4 panels:
* **Console**: where the results are printed
* **Code Editor**: where you have to write your code
* **Workspace**: where the objects are stored
* **Files, Plots, Package, Help and Viewer**: where datascience materials are

<p style="text-align:center;"><img src="http://www.sthda.com/sthda/RDoc/images/rstudio.png" width="400">
---

# From Science to Data Science in 4 clicks

* In RStudio IDE

  * Tools > Global Options ... > Appearance 
  * Scroll down to "Vibrant Ink" and click Apply > OK
  
---

<p style="text-align:center;">**Welcome to ...**

--
background-image: url(https://media2.giphy.com/media/10zxDv7Hv5RF9C/giphy.gif?cid=3640f6095c7801104a4c3632591e5e42)

---

# Introduction to data science with R

R in 3 points:
 * Create objects made of elements 
 * Use of actions on objects to change them
 * Display and save the results of your actions

---

# What is R?

* R is a programming language

* R is object oriented 
  * **Arrow assigment** to create objects: `<-`

Some examples of assigment:

```{r, eval=FALSE, echo=TRUE}
numerics <- 2

characters <- "two"

vectors <- c(2,"two")

arrays <- 1:2

dataframes <- data.frame(col1 = c("one","two"), col2 = c(1,2))

functions <- function(x){x^2}

plots <- ggplot(data = dataframes, aes(x = col1, y = col2)) +
  geom_point()
```

---

# What is R?

R is a case-sensitive language, x and X do not refer to the same object

Object names:
- can be created using letters, digits and some special characters ( _ and . but not -)
- must not start with a digit or a . followed by a digit.
- avoid names already used by the system, e.g. c, q, t, C, D, F, I, T, diff, ...)

Be carefull, R doen't save objects, you have to save the code to recreate them everytime.

---

# How does R work?

Users enter a line with a command after the prompt and press `Enter`.

The programme carries out the command and prints the result if relevant. For example, if the expression 2 + 2 is typed in, the following is printed in the R console:

```{r, echo=TRUE}
2 + 2
```

<mark>The prompt `>` indicates that R is ready for another command</mark>  
* <mark>If a command is incomplete at the end of a line, the prompt + is displayed</mark> on subsequent lines until the command is syntactically complete

```{r, eval=FALSE}
test <- data.frame(x = rnorm(10000000), y = rnorm(10000000)
```

* If the console shows a <mark>red icone in the top right corner, the console is currently processing your script</mark>

```{r, eval=FALSE}
test <- data.frame(x = rnorm(10000000), y = rnorm(10000000))

summary(lm(y~x, test))
```


* If the shows a <mark>red "stop" button, your code has produced an error and you need to click on it to exit the debbug mode</mark>

---

![](https://support.rstudio.com/hc/en-us/article_attachments/201608498/shiny-debugging.png)
---

# R keyboard short cuts and syntax

--

Short cuts

* `Ctl + Enter` : process line
* `Alt + -` : insert arrow (<-)
* `Ctl + L` : clear console

--

Syntax

* `#` to comment a line
  * used to explaine the what and why of the code
  * used to disable a code line (can be done with Ctl+Maj+C)
  
* `?keyword` looks for help in the packages in use
* `??keyword` looks for help in all the packages installed

---

# Object Classes

* numeric
   * 2, 5.3, 10^2

* character
  * "one", "One", "ONE"

* boolean
  * TRUE and FALSE

---

# Basic Operators

* Arithmetic Operators include:

|Operator |Description             |
|---------|------------------------|
|+        |addition                |
|-        |subtraction             |
|*        |multiplication          |
|/        |division                |
  
* Arithmetic Operators include:

|Operator |Description             |
|---------|------------------------|
|> and <  |greater than            |
|>= and <=|greater than or equal to|
|==       |exactly equal to        |
|!=       |not equal to            |

---

# Basic Examples Using operators

```{r, eval=FALSE, echo=TRUE}
2

2 + 3 

2 > 3
```

---

# Basic Examples Using Assigment

```{r, eval=FALSE, echo=TRUE}
numeric_two <- 2 # value 2 assigned to numeric_two object
numeric_two

numeric_three <- 3 # value 3 assigned to numeric_three object
numeric_three

numeric_two + numeric_three

character_two <- "Two" # character "Two" assigned to character_two object
character_two
```

## Whoops

```{r, error=TRUE, eval=FALSE, echo=TRUE}
character_two + numeric_three
```

---

# Using Functions

Functions are transforming object by diffining their arguments

Have a look at our first function:

```{r, eval=FALSE, echo=TRUE}
?c

# Description: This is a generic function which combines its arguments.
# Examples
# c(1,7:9)
# c(1:5, 10.5, "next")
```

Most usefull functions

```{r, eval=FALSE, echo=TRUE}
install.packages("PackageName")

library(PackageName)

getwd()
setwd("C:/path/to/your/folder")
```

WARNING: path in R are using UNIX system so Apple and Linux users are fine but Windows users have to replace `\` by `/` in any path.

---

# Using Packages

Functions are implemented in Package

* Some packages are already installed by default (e.g., base, stats, ...)

* Most of them have to be downloaded 
    * From CRAN
    * From GitHub

To access all of the functions a particular package, it must be downloaded once and loaded into the workspace each time you are starting a new session. For example, to load the tidyverse package:

```{r, eval=FALSE, echo=TRUE}
install.package("tidyverse") # once

library(tidyverse) # at the begining of each script to be loaded every new session
```

---

# Basic Objects

* Vector

* Factor

* Array

* Matrix

* Data Frame

* List

---

# Vectors

Vectors are the simplest type of object in R. There are 3 main
types of vectors:

```{r, eval=FALSE, echo=TRUE}
numeric_vector <- c(10.4, 5.6, 3.1, 6.4, 21.7) # Numeric vector
numeric_vector

character_vector <- c("one", "two", "three") # Character vector
character_vector

boolean_vector <- c(TRUE, FALSE, TRUE) # Boolean vector
boolean_vector

heterogenous_vector <- c("one", 2, TRUE) # Heterogenous vector
heterogenous_vector
```

* Missing Values

In some cases the entire contents of a vector may not be known. For example, missing data from a particular data set. A place can be reserved for this by assigning it the special value NA.

---

# Indexing and Modifying Vectors

To access to a specific value (also called indexing) use `ObjectName[number]`

```{r, eval=FALSE, echo=TRUE}
numeric_vector[1]

character_vector[3]
```

To alter the contents of a vector, similar methods can be used.

```{r eval=FALSE, echo=TRUE}
# For example, to modify the 1st element of numeric_vector and assign it a value 5
numeric_vector[1] <- 5
numeric_vector
```

---

# Factors

A factor is a special type of vector used to represent character data (e.g. gender, social class, etc.) ordered according to numerical values

```{r, eval=FALSE, echo=TRUE}
character_vector

character_vector <- as.factor(character_vector)

character_vector
```

Example

>Consider a survey that has data on 200 females and 300 males. If the first 200 values are from females and the next 300 values are from males, one way of representing this is to create a vector

```{r, eval=FALSE, echo=TRUE}
# Vector of characters
gender <- c(rep("female", 200), rep("male", 300))
# To change this into a factor
gender <- as.factor(gender) 
# The factor gender is stored as 1 female and 2 male called a level of the factor.

# To determine the levels of a factor the function levels() can be used:
levels(gender)
```

---

# Array

Is the the case of vector made of numeric values

---

# Matrix

A matrix is a two-dimensional array of numbers, it has rows and columns

In R matrices are represented as vectors with dimensions.

```{r, eval=FALSE, echo=TRUE}
m <- rnorm(12) # Creates a vector of 12 random numbers
m

matrix(m, nrow=3, ncol=4, byrow=T) 
# Causes R to treat the vector of 12 numbers as a 3 x 4 matrix.
```

---

# DataFrame

The most important object in R!

DataFrame are spreedsheet made of rows and columns

Columns can have different class (e.g., character columns and numeric columns)

```{r, eval=FALSE, echo=TRUE}
dataframes <- data.frame(col1 = c("one","two"), col2 = c(1,2))
dataframes
```

Values from dataframe can be accessed using `DataframeName[RowNumber,ColNumber]`

```{r, eval=FALSE, echo=TRUE}
dataframes[1,1] 
# gives the value in the 1st row and 1st column of "dataframes" object

dataframes[2,1] 
# gives the value in the 2nd row and 1st column of "dataframes" object

dataframes[1,2] 
# gives the value in the 1st row and 2nd column of "dataframes" object
```

Columns from dataframe can be accessed using `DataframeName$ColName`

```{r, eval=FALSE, echo=TRUE}
dataframes$col1

dataframes$col2
```

---

# Indexing Data Frames

By leaving row or column number empty you select all the values for the row or column indicated.

```{r, eval=FALSE, echo=TRUE}
dataframes[2,] 
# returns all the columns value for the 2nd row

dataframes[,2] 
# returns all the rows in the 2nd column (same as using dataframes$col2)
```

---

# Lists

Lists are an ordered collection of object which can have different classes

```{r, eval=FALSE, echo=TRUE}
lists <- list(name="Fred", wife="Mary", no.children=3, child.ages=c(4,7,9)) 
# list of 4 objects
```

>In general you don't want to deal with lists because they are very difficult to handle

---
class: center, middle

# Read and Save Data

---

# How to use external data

Dataframe objects (object type spreedsheet containing data) can be 
* Created in R
* Uploaded from an external file

If the dataframe is uploaded from an external file you can 
* Use R studio IDE with the `Files` panel (for beginners)
* Use a funtion to read the type of file (natural way)

The function use depend on the type of file

```{r, eval=FALSE, echo=TRUE}
text_file <- read.delim("C:/path/to/your/file.txt") 
# create dataframe object from a text file

csv_file <- read.csv("C:/path/to/your/file.csv") 
# create dataframe object from a csv file
```

Note on file types: always try to save to .csv which is the most common data file type. So avoid to upload .xls/.xlsx files or even spss files

---

# How to save data 

Saving in RStudio IDE is only for script documents in .R format. To save data from dataframe object you have to use a dedicated function like `write.csv()` with several arguments:
* x : the object to be written
* file : the path where the object has to be written with object name and extension
* row.names : a logical value (TRUE or FALSE) indicating whether the row names of x are to be written along with x

```{r, eval=FALSE, echo=TRUE}
dataframes <- data.frame(col1 = c("one","two"), col2 = c(1,2))

write.csv(
  x = dataframes, 
  file = "C:/path/to/object/dataframes.csv", 
  row.names = FALSE)
```

---

# How to solve your pRoblems

1. Look at your error
  * If it's obvious, solve it by yourself
  * If it's not obvious, copy paste the error in google
  
2. Look at your object (`str(ObjectName)`)

3. Look at the function (documentation)

4. Look at the web
  * Google "R how to ..."
  * Stack Overflow

---
class: inverse, center, middle

# Gentle introduction to emotion analysis

## Sentiment Analysis

---

# Principe of basic sentiment analysis

* Several databases of all existing words weighted accord their emotionality are available
* Associate the words of the text to analyse with one of these databases
* Average the results according unit of interest (sentence, chapter, tweet, review)

---

# Tidy text data

* Let’s have a first go with some text:

```{r, eval=FALSE, echo=TRUE}
library(tidyverse)
library(tidytext)

text <- c(
  "I love R",
  "R is magic",
  "It is hard and boring at the beginning",
  "but once you have started",
  "you just can't stop using it"
)

text_as_df <- tibble(
  line = 1:5,
  text = text
  )

unnest_tokens(
  tbl = text_as_df,
  output = word,
  input = text
  )
```

---

# Dealing with real text data

* Load libraries

```{r, eval=FALSE, echo=TRUE}
library(janeaustenr)
library(textdata)
```

* Some data wrangling

```{r, eval=FALSE, echo=TRUE}
jane_tidy <- austen_books() %>%
  group_by(book) %>%
  mutate(linenumber = row_number()) %>% 
  mutate(chapter = str_detect(text, "CHAPTER") %>% cumsum()) %>%
  ungroup() %>%
  unnest_tokens(word, text)
```

* Remove stop word

```{r, eval=FALSE, echo=TRUE}
jane_tidy_words <- jane_tidy %>% 
  anti_join(stop_words)
```

* Some plots

```{r, eval=FALSE, echo=TRUE}
jane_tidy_words %>% 
  filter(book == "Emma") %>% 
  group_by(chapter) %>% 
  summarise(n = n()) %>%
  ggplot(aes(chapter, n)) + 
  geom_line() + 
  geom_smooth(se=FALSE)
```

---

# Emotion lexicons

Three of these lexicons are based on unigrams, i.e., single words. 
* The `nrc` lexicon categorizes words in a binary fashion (“yes”/“no”) into categories of positive, negative, anger, anticipation, disgust, fear, joy, sadness, surprise, and trust. 
* The `bing` lexicon categorizes words in a binary fashion into positive and negative categories. 
* The `AFINN` lexicon assigns words with a score that runs between -5 and 5, with negative scores indicating negative sentiment and positive scores indicating positive sentiment. 

---

# Sentiment analysis by steps

* Download Emotion Lexicon

```{r, eval=FALSE, echo=TRUE}
bing_lexicon <- get_sentiments("bing")
```

* Attribute the emotionality to all the words

```{r, eval=FALSE, echo=TRUE}
jane_austen_sentiment <- jane_tidy_words %>%
  inner_join(bing_lexicon) %>%
  count(book, index = linenumber %/% 80, sentiment) %>%
  spread(sentiment, n, fill = 0) %>%
  mutate(sentiment = positive - negative)
```

* Plot the results

```{r, eval=FALSE, echo=TRUE}
ggplot(jane_austen_sentiment, aes(index, sentiment, fill = book)) +
  geom_col(show.legend = FALSE) +
  facet_wrap(~book, ncol = 2, scales = "free_x")
```

---

# What about another Lexicon?

* Download the AFINN Lexicon

```{r, eval=FALSE, echo=TRUE}
afinn_sentiments <- get_sentiments("afinn")
```

* Plot the results

```{r, eval=FALSE, echo=TRUE}
jane_tidy_words %>% 
  inner_join(afinn_sentiments) %>%
  group_by(book, chapter) %>% 
  summarise(avg_score = mean(value)) %>%
  ggplot(aes(chapter, avg_score, group=book, colour = book)) + 
  geom_line() + 
  geom_smooth(se = FALSE)
```

---
class: inverse, center, middle

# Gentle introduction to emotion analysis

## Facial Expression

---

# Automatic facial expressions recognition systems

* First attempt in 1978 (reported by Zeng et al., 2009)
* Numerous different academic systems since (see revue by Zeng et al., 2009)
* VicarVision first company to provide a commercial access to FaceReader in 2005
* Today more than 20 companies

---

# Automatic emotion detection procedure

A process in 3 steps:
* Face Detection
* Facial Landmark Detection
* Classification

Result = recognition probability for a labelled category (e.g. Action Unit, Basic Emotion, ...)

```{r out.width = "100%"}
knitr::include_graphics("./img/automatic_steps.png") 
```

---

# Back to the theory

* Automatic emotion recognition systems are spreading across many sensitive domains (e.g. healthcare, automotive, security, ...)
* However their accuracy is still not perfect

```{r out.width = "100%"}
knitr::include_graphics("./img/automatic_rec.png") 
```

Image: https://emotionknow.com/2017/10/27/the-state-of-emotion-recognition-via-facial-expressions-reviewing-google-amazon-microsoft-affectiva-kairos-and-clarifai/

---

# Evaluation of Facial Expression with Affectiva Affdex SDK

* Software vs. Software Development Kit (SDK) vs. Application Programming Interface (API)
  * Software: stand alone local processing
  * SDK: component local processing
  * API: stand alone remote processing

Affectiva Affdex SDK
* Free for research
* But needs some dev. skills

---

# Spontaneous Facial Expressions from DynEmo Database

```{r out.width = "100%"}
knitr::include_graphics("./img/dynemo_video.png") 
```

---

# Accessing the data and data wrangling

* Libraries

```{r, eval=FALSE, echo=TRUE}
library(tidyverse)
library(mgcv)
```

* Code

```{r, eval=FALSE, echo=TRUE}
automatic_recognition_tidy <- 
  "https://raw.githubusercontent.com/damien-dupre/data/master/automatic_recognition_data.csv" %>% 
  readr::read_csv() %>% 
  dplyr::select(source, TimeStamp, joy, fear, disgust, sadness, anger, surprise) %>% 
  tidyr::gather(emotion_expressed, value, -source, -TimeStamp) %>% 
  tidyr::separate(source, c("emotion_triggered", "gender"), sep = "[.]") %>% 
  dplyr::mutate(type = case_when(
    emotion_expressed == emotion_triggered ~ "taget",
    TRUE ~ "non-target"
  )) %>% 
  dplyr::mutate(emotion_triggered = as.factor(emotion_triggered)) %>% 
  dplyr::mutate(type = as.factor(type))
```

* Basic plot

```{r, eval=FALSE, echo=TRUE}
automatic_recognition_tidy %>% 
  ggplot(aes(TimeStamp,value, color = emotion_expressed)) + 
  geom_line() +
  facet_grid(gender~emotion_triggered)
```

---

# Generalized Additive (Mixed) Models

* Non linear regression

```{r, eval=FALSE, echo=TRUE}
test_gam <- mgcv::gam(
  value ~ s(TimeStamp, by = type),
  correlation = corAR1(),
  data = automatic_recognition_tidy,
  method = "REML"
  )
plot(test_gam)

summary(test_gam)

vis.gam(test_gam,theta=-55,color="heat")
```

* GAMM takes random factors but are very long to process

```{r, eval=FALSE, echo=TRUE}
# test_gamm <- mgcv::gamm(
#   value ~ s(TimeStamp, by = type),
#   correlation=corAR1(),
#   data = automatic_recognition_tidy,
#   method = "REML",
#   random=list(gender=~1)
# )
# 
# plot(test_gamm$gam)
# 
# summary(test_gamm$gam)
```

---
class: inverse, center, middle

# Gentle introduction to emotion analysis

## Physiology

---

# Attempts to link physiology with emotions in psychology research

A considerable number of studies were performed in order to identify the physiological correlates of emotions. To name a few:
* HR and EDA categorization according to Valence and Arousal (Lang, Bradley and Cuthbert, 1990)
* Somatovisceral afferance model of emotion (Cacioppo et al., 2000)
* Physiological response specificity in emotion when considering subtypes of distinct emotions (meta-analysis by Kreibig, 2010)

---

# Affective computing perspective 

Some physiological databases were developed to allow machine learning systems to identify the physiological patterns of emotions, for example:
* Database for Emotion Analysis using Physiological Signals (DEAP; Koelstra et al., 2012)
* Multi-Modal Emotion Recognition in Response to Videos (MAHNOB-HCI; Soleymani et al., 2012)
* Affective computing challenges to recognize emotions from physiological measures (AV+EC 2015 “Bridging Across Audio, Video and Physio”)

---

# Development of systems to evaluate emotions ‘in the wild’

With the generalization of wireless physiological sensors, new projects were launched to evaluate emotions (and other psychological states):
* Driver psychological state (e.g. Li et al., 2016)
* Health real-time monitoring (e.g. Picard et al., 2015)
* Overall stress detection (e.g. Ollander et al., 2016)
* Sport science (e.g. Cavalade et al., 2015)

---

# Extracting the VAD from biometrics

```{nomnoml}
#stroke: orange
#align: center

[Emotion]->[Arousal]
[Emotion]->[Valence]
[Emotion]->[Dominance]
[Arousal]->[Heart Rate]
[Arousal]->[Breathing Rate]
[Arousal]->[Skin Temperature]
[Arousal]->[Skin Conductance Level]
[Arousal]->[Skin Conductance Response]
[Valence]->[Heart Rate Variability]
```

---

# Data processing steps

```{nomnoml}
#stroke: orange
#align: center

[Cleaning Data Streams]->[Feature Extraction]
[Feature Extraction]->[Streams Sync]
[Streams Sync]->[Statistical Treatment]
```

---

# 1. Cleaning Data Streams

* Identification of outlier data

```{r}
tibble::tribble(
  ~Measurement, ~`Exclusion criteria`,
  "Heart Rate", "HR < 50 bpm or HR > 220 bpm",
  "Breathing Rate", "BR < 10 rpm or BR > 60 rpm",
  "Skin Temperature", "ST < 30°C or ST > 40°C",
  "Electrodermal Activity", "EDA < 2mS or EDA < 20mS"
  ) %>%
  knitr::kable(format='html') %>%
  kableExtra::kable_styling(font_size = 12)
```

---

# 2. Feature Extraction


---

# 3. Streams Sync


---

# 4. Statistical Treatment

---

# Predict Arousal from physiological measurement

---
class: inverse, center, middle

# Thanks for your attention!

---








